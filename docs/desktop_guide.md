# AIRA 桌面前端使用指南

## 概述

AIRA Desktop 是一个基于 PyQt6 的现代化桌面应用程序，为 AIRA 对话机器人提供友好的图形界面。

## 功能特性

- **实时对话**：与 AIRA 进行流畅的对话交互
- **多会话管理**：支持创建和切换多个对话会话
- **角色切换**：快速切换不同的对话角色（aira、tsundere、cold 等）
- **连接状态监控**：实时显示与后端服务的连接状态
- **美观的消息界面**：类似即时通讯软件的气泡式消息显示
- **配置管理**：可自定义 API 地址、显示设置等
- **工具调用显示**：显示 AI 使用的工具和记忆信息

## 安装依赖

使用 uv 安装桌面前端所需的依赖：

```bash
# 安装桌面前端依赖
uv sync --extra desktop

# 或安装所有可选依赖
uv sync --all-extras
```

依赖包括：
- PyQt6：Qt 图形界面框架
- qasync：Qt 与 asyncio 的集成

## 启动应用

### 方法 1：使用启动脚本

```bash
# 直接运行启动脚本
uv run python run_desktop.py
```

### 方法 2：作为模块运行

```bash
# 作为 Python 模块运行
uv run python -m aira.desktop.main
```

### 方法 3：在代码中使用

```python
from aira.desktop import run_desktop_app

run_desktop_app()
```

## 使用说明

### 启动后端服务

在使用桌面前端之前，需要先启动 AIRA 后端服务：

```bash
# 启动 API 服务
uv run uvicorn aira.server.api:create_app --factory --reload
```

默认情况下，后端服务运行在 `http://localhost:8000`。

### 主界面说明

#### 顶部工具栏

- **会话选择器**：选择现有会话或创建新会话
- **角色选择器**：选择对话角色（aira、tsundere、cold 等）
- **连接状态指示器**：显示与后端的连接状态
  - 🟢 已连接：后端服务正常
  - 🔴 未连接：无法连接到后端

#### 对话标签页

- **消息显示区域**：以气泡形式显示对话历史
  - 绿色气泡：用户消息（右对齐）
  - 白色气泡：AI 回复（左对齐）
  - 显示时间戳和工具调用信息
- **输入框**：输入要发送的消息
- **发送按钮**：发送消息（也可按 Enter 键）
- **清空对话按钮**：清空当前会话的所有消息

#### 设置标签页

- **连接设置**：配置后端 API 地址
- **显示设置**：调整字体大小、时间戳显示等
- **对话设置**：配置最大历史记录数量、自动保存等
- **关于信息**：应用版本和说明

### 创建新会话

1. 点击顶部的会话选择器
2. 选择"新会话"选项
3. 系统会自动生成一个唯一的会话 ID

### 切换角色

1. 点击顶部的角色选择器
2. 从下拉列表中选择想要的角色
3. 新的对话将使用选定的角色风格

可用角色：
- `aira`：可塑性记忆的艾拉（默认）
- `tsundere`：傲娇型
- `cold`：冷淡型
- `straight`：直率型
- `dark`：暗黑型
- `ojousama`：大小姐型
- `king`：霸道型
- `slave`：顺从型
- `otaku`：宅系型
- `athlete`：运动型

### 消息功能

- **发送消息**：输入文本后点击"发送"或按 Enter 键
- **查看工具调用**：AI 使用的工具会在消息下方显示
- **复制消息**：鼠标选中消息文本即可复制

## 配置说明

### API 地址配置

如果后端服务运行在非默认地址，可以在设置页面修改：

1. 切换到"设置"标签页
2. 在"连接设置"中修改 API 地址
3. 点击"更新连接"按钮

### 显示配置

可以自定义以下显示选项：
- 字体大小（8-24pt）
- 是否显示时间戳
- 是否显示工具调用信息

## 故障排除

### 连接失败

如果连接状态显示"未连接"：

1. 确认后端服务是否已启动
2. 检查 API 地址是否正确
3. 查看后端日志是否有错误

### 消息发送失败

如果消息发送后没有响应：

1. 检查连接状态
2. 查看状态栏的错误提示
3. 确认后端配置正确（模型、API 密钥等）

### 界面卡顿

如果界面响应缓慢：

1. 清空过长的对话历史
2. 减少最大历史记录数量
3. 关闭不必要的标签页

## 键盘快捷键

- `Enter`：发送消息
- `Ctrl+C`：复制选中的消息文本

## 技术架构

- **UI 框架**：PyQt6
- **异步支持**：qasync（Qt + asyncio）
- **HTTP 客户端**：httpx
- **后端通信**：RESTful API

## 目录结构

```
aira/desktop/
├── __init__.py          # 模块导出
├── app.py               # 应用主类
├── main.py              # 启动入口
├── client.py            # API 客户端
├── windows/             # 窗口模块
│   ├── __init__.py
│   └── main_window.py   # 主窗口
└── widgets/             # 界面组件
    ├── __init__.py
    ├── chat_widget.py   # 对话组件
    └── settings_widget.py # 设置组件
```

## 未来计划

- [ ] 支持流式响应显示
- [ ] 添加语音输入功能
- [ ] 支持图片发送和显示
- [ ] 会话历史本地存储
- [ ] 自定义主题和样式
- [ ] 快捷回复功能
- [ ] 对话导出功能
- [ ] 多窗口支持

## 反馈与贡献

如有问题或建议，请提交 Issue 或 Pull Request。

